<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"> 
    <title data-i18n="titulo_principal">üîî Control del Campanar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="idiomas.js"></script>
    <script src="Calefaccion.js"></script>
    <script src="Campanas.js"></script>
    <script src="configuracion.js"></script>
    <script src="ota.js"></script>
    <!--<link rel="stylesheet" type="text/css" href="style.css">-->
    <link rel="stylesheet" type="text/css" href="campanas.css">
    <link rel="stylesheet" type="text/css" href="Calefaccion.css">
    <link rel="stylesheet" type="text/css" href="configuracion.css">
</head>
<body>
    <div class="container">
        <header>
            <h1 data-i18n="titulo_principal">üîî Control del Campanar</h1>
        </header>

        <!-- CUADRO 1: TOQUES Y CAMPANADAS -->
        <section class="seccion-toques">
            <h3>
                <span class="icono">üîî</span>
                <span data-i18n="seccion_toques">Tocs i Campanades</span>
            </h3>
            
            <div class="botones-toques">
                <button class="button Misa" onclick="SelMisa()">
                    <span class="button-icon">‚õ™</span>
                    <span data-i18n="boton_misa">Missa</span>
                </button>
                
                <button class="button Difuntos" onclick="SelDifuntos()">
                    <span class="button-icon">üïäÔ∏è</span>
                    <span data-i18n="boton_difuntos">Difunts</span>
                </button>
                
                <button class="button Fiesta" onclick="SelFiesta()">
                    <span class="button-icon">üéâ</span>
                    <span data-i18n="boton_fiesta">Festa</span>
                </button>
            </div>
            
            <div class="estado-toques">
                <div class="campanitas">
                    <div class="campana" id="campana0">üîî</div>
                    <div class="campana" id="campana1">üîî</div>
                </div>
                <button class="button-secondary" onclick="pararSecuencia()" id="btnParar" data-i18n="parar_secuencia">
                    ‚èπÔ∏è Aturar Seq√º√®ncia
                </button>
            </div>
        </section>

        <!-- CUADRO 2: CALEFACCI√ìN CON CONTROL COMPLETO -->
        <section class="seccion-calefaccion">
            <h3>
                <span class="icono">üî•</span>
                <span data-i18n="seccion_calefaccion">Sistema de Calefacci√≥</span>
            </h3>
            
            <div class="calefaccion-controles">
                <div class="estado-calefaccion">
                    <svg class="icono-calefaccion" viewBox="0 0 24 24" fill="none">
                        <path id="iconoCalefaccion" stroke="orange" stroke-width="2" 
                              d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1L13.5 2.5L16.17 5.17C15.24 5.06 14.32 5 13.38 5H10.63C9.68 5 8.76 5.06 7.84 5.17L10.5 2.5L9 1L3 7V9H4.5C5.1 9 5.63 9.26 6 9.67V14.37C6 15.32 6.06 16.24 6.17 17.16L3.5 14.5L2 16L8 22H10V20.5C10 19.9 10.26 19.37 10.67 19H14.37C15.32 19 16.24 18.94 17.16 18.83L14.5 21.5L16 23L22 17V15H20.5C19.9 15 19.37 14.74 19 14.33V9.63C19 9.1 19.26 8.63 19.67 8H21Z"/>
                    </svg>
                    <span class="texto-estado" id="textoCalefaccion" data-i18n="calefaccion_apagada">Apagada</span>
                </div>
                
                <!-- ‚úÖ A√ëADIR: Display de tiempo configurado/restante -->
                <div class="display-tiempo">
                    <span class="tiempo-configurado" id="minutosCalefaccion">030m</span>
                </div>
                
                <div class="botones-calefaccion">
                    <button class="button-calefaccion" onclick="toggleCalefaccion()" data-i18n="calefaccion_encender">
                        üî• Encendre
                    </button>
                    <button class="button-reloj" id="btnReloj" onclick="abrirModalMinutos()" data-i18n="calefaccion_configurar">
                        ‚è∞ Configurar
                    </button>
                </div>
            </div>
        </section>

        <!-- CUADRO 3: CONFIGURACI√ìN Y GESTI√ìN -->
        <section class="seccion-configuracion">
            <h3>
                <span class="icono">‚öôÔ∏è</span>
                <span data-i18n="seccion_configuracion">Configuraci√≥ i Gesti√≥</span>
            </h3>
            
            <div class="botones-configuracion">

                <!-- ‚úÖ GESTI√ìN DE ALARMAS - Mantener al final -->
                <a href="/Alarmas.html" class="boton-config">
                    <div class="icono-config">üìÖ</div>
                    <div class="texto-config">
                        <strong data-i18n="gestion_alarmas">Gesti√≥ d'Alarmes</strong>
                        <small data-i18n="gestion_alarmas_desc">Programar tocs autom√†tics</small>
                    </div>
                </a>

                <!-- ‚úÖ SELECTOR DE IDIOMA - Mantener estilo original -->
                <div class="boton-config selector-idioma-config">
                    <div class="icono-config">üåç</div>
                    <div class="texto-config">
                        <strong data-i18n="idioma">Idioma</strong>
                        <select id="selectorIdioma" onchange="cambiarIdioma(this.value)">
                            <option value="ca">Catal√†</option>
                            <option value="es">Espa√±ol</option>
                        </select>
                    </div>
                </div>
                
                <!-- ‚úÖ CONFIGURACI√ìN HABILITADA CON PIN -->
                <div class="boton-config" onclick="abrirModalPin()">
                    <div class="icono-config">üîß</div>
                    <div class="texto-config">
                        <strong data-i18n="configuracion">Configuraci√≥</strong>
                        <small data-i18n="configuracion_desc">Ajustos del sistema</small>
                    </div>
                </div>
                
                <!-- ‚úÖ ACERCA DE - Estilo original -->
                <div class="boton-config" onclick="abrirModalAcercaDe()">
                    <div class="icono-config">‚ÑπÔ∏è</div>
                    <div class="texto-config">
                        <strong data-i18n="acerca_de">Acerca de...</strong>
                        <small data-i18n="acerca_de_desc">Informaci√≥ del sistema</small>
                    </div>
                </div>


            </div>
        </section>
    </div>

    <!-- ‚úÖ MODAL PARA CONFIGURAR MINUTOS CON VALIDACI√ìN -->
    <div id="modalMinutos" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="configurar_tiempo">Configurar Temps</h2>
                <span class="close" onclick="cerrarModalMinutos()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="selector-digitos">
                    <div class="digito-container">
                        <button class="digito-btn" onclick="incrementarDigito(0)">‚ñ≤</button>
                        <div class="digito" id="digito0">0</div>
                        <button class="digito-btn" onclick="decrementarDigito(0)">‚ñº</button>
                    </div>
                    
                    <div class="digito-container">
                        <button class="digito-btn" onclick="incrementarDigito(1)">‚ñ≤</button>
                        <div class="digito" id="digito1">3</div>
                        <button class="digito-btn" onclick="decrementarDigito(1)">‚ñº</button>
                    </div>
                    
                    <div class="digito-container">
                        <button class="digito-btn" onclick="incrementarDigito(2)">‚ñ≤</button>
                        <div class="digito" id="digito2">0</div>
                        <button class="digito-btn" onclick="decrementarDigito(2)">‚ñº</button>
                    </div>
                    
                    <div class="minutos-label">
                        <span data-i18n="minutos">minuts</span>
                    </div>
                </div>
                
                <div class="total-minutos">
                    <span data-i18n="total_minutos">Total:</span>
                    <span id="totalMinutos">030</span>
                    <span data-i18n="minutos">minuts</span>
                </div>
                
                <!-- ‚úÖ NUEVA ADVERTENCIA DE L√çMITE M√ÅXIMO -->
                <div id="advertenciaLimite" class="advertencia-limite" style="display: none;">
                    <span class="icono-advertencia">‚ö†Ô∏è</span>
                    <span data-i18n="limite_maximo">M√†xim perm√®s: 120 minuts</span>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-cancelar" onclick="cerrarModalMinutos()" data-i18n="cancelar">Cancel¬∑lar</button>
                <button class="btn-aceptar" id="btnAceptarMinutos" onclick="aceptarMinutos()" data-i18n="aceptar">Acceptar</button>
            </div>
        </div>
    </div>

    
    <div id="modalAcercaDe" class="modal">
        <div class="modal-content modal-acerca-de">
            <div class="modal-header modal-header-info">
                <h2 data-i18n="acerca_de">Acerca de...</h2>
                <span class="close" onclick="cerrarModalAcercaDe()">&times;</span>
            </div>
            
            <div class="modal-body modal-body-info">
                <div class="info-logo">
                    üîî
                </div>
                
                <div class="info-titulo">
                    <h3 data-i18n="sistema_campanario">Sistema de Control del Campanar</h3>
                    <p class="version" id="versionSistema">Versi√≥ 1.0.0</p>
                </div>
                
                <div class="info-seccion">
                    <h4 data-i18n="desarrollado_por">Desenvolupat per:</h4>
                    <p><strong>Tu Nombre / Tu Empresa</strong></p>
                    <p class="email">contacto@tuempresa.com</p>
                </div>
                
                <div class="info-seccion">
                    <h4 data-i18n="caracteristicas">Caracter√≠stiques:</h4>
                    <ul>
                        <li data-i18n="feat_control_campanas">Control remot de campanes</li>
                        <li data-i18n="feat_calefaccion">Sistema de calefacci√≥ intel¬∑ligent</li>
                        <li data-i18n="feat_multiidioma">Interf√≠cie multiidioma</li>
                        <li data-i18n="feat_alarmas">Programaci√≥ d'alarmes</li>
                    </ul>
                </div>
                
                <div class="info-seccion">
                    <h4 data-i18n="tecnologia">Tecnologia:</h4>
                    <p>ESP32 + WebSocket + HTML5</p>
                </div>
                
                <div class="info-copyright">
                    <p data-i18n="copyright">¬© 2024 Tu Empresa. Tots els drets reservats.</p>
                    <p class="licencia" data-i18n="licencia">Llic√®ncia: MIT</p>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-aceptar btn-solo" onclick="cerrarModalAcercaDe()" data-i18n="cerrar">Tancar</button>
            </div>
        </div>
    </div>

    <!-- ‚úÖ MODAL DE PIN PARA ACCEDER A CONFIGURACI√ìN -->
    <div id="modalPin" class="modal">
        <div class="modal-content modal-pin">
            <div class="modal-header">
                <h2 data-i18n="pin_acceso">Acc√©s a Configuraci√≥</h2>
                <span class="close" onclick="cerrarModalPin()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="pin-container">
                    <p data-i18n="introducir_pin">Introdueix el PIN d'acc√©s:</p>
                    <input type="password" id="inputPin" maxlength="4" placeholder="****" autocomplete="off">
                    <div id="errorPin" class="error-pin" style="display: none;">
                        ‚ùå <span data-i18n="pin_incorrecto">PIN incorrecte</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-cancelar" onclick="cerrarModalPin()" data-i18n="cancelar">Cancel¬∑lar</button>
                <button class="btn-aceptar" onclick="verificarPin()" data-i18n="aceptar">Acceptar</button>
            </div>
        </div>
    </div>

    <!-- ‚úÖ MODAL DE CONFIGURACI√ìN PRINCIPAL -->
    <div id="modalConfiguracion" class="modal">
        <div class="modal-content modal-config">
            <div class="modal-header">
                <h2 data-i18n="configuracion">Configuraci√≥</h2>
                <span class="close" onclick="cerrarModalConfiguracion()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="config-opciones">
                    <div class="config-opcion" onclick="abrirConfigTelegram()">
                        <div class="icono-config-grande">üì±</div>
                        <div class="texto-config-opcion">
                            <strong data-i18n="config_telegram">Telegram</strong>
                            <small data-i18n="config_telegram_desc">Configurar notificacions</small>
                        </div>
                        <div class="flecha-config">‚Ä∫</div>
                    </div>
                    
                    <div class="config-opcion" onclick="abrirModalOTA()">
                        <div class="icono-config-grande">üîÑ</div>
                        <div class="texto-config-opcion">
                            <strong data-i18n="actualizacion">Actualitzaci√≥</strong>
                            <small data-i18n="actualizacion_desc">Actualitzar firmware</small>
                        </div>
                        <div class="flecha-config">‚Ä∫</div>
                    </div>
                    
                    <div class="config-opcion" onclick="abrirModalBackup()">
                        <div class="icono-config-grande">üíæ</div>
                        <div class="texto-config-opcion">
                            <strong data-i18n="backup">Backup</strong>
                            <small data-i18n="backup_desc">Descarregar configuracions</small>
                        </div>
                        <div class="flecha-config">‚Ä∫</div>
                    </div>
                    
                    <div class="config-opcion" onclick="abrirConfigReset()">
                        <div class="icono-config-grande">üîÅ</div>
                        <div class="texto-config-opcion">
                            <strong data-i18n="config_reset">Reset</strong>
                            <small data-i18n="config_reset_desc">Reiniciar el sistema</small>
                        </div>
                        <div class="flecha-config">‚Ä∫</div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-aceptar btn-solo" onclick="cerrarModalConfiguracion()" data-i18n="cerrar">Tancar</button>
            </div>
        </div>
    </div>

    <!-- ‚úÖ MODAL DE CONFIGURACI√ìN TELEGRAM -->
    <div id="modalConfigTelegram" class="modal">
        <div class="modal-content modal-config-telegram">
            <div class="modal-header">
                <h2>üì± <span data-i18n="config_telegram">Telegram</span></h2>
                <span class="close" onclick="cerrarModalConfigTelegram()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label data-i18n="nombre_dispositivo">Nom del dispositiu:</label>
                    <input type="text" id="nombreDispositivo" placeholder="nombre" maxlength="20">
                    <small data-i18n="nombre_dispositivo_ayuda">Aquest nom s'utilitzar√† per identificar el campanari</small>
                </div>
                
                <div class="form-group">
                    <label data-i18n="ubicacion_dispositivo">Ubicaci√≥:</label>
                    <input type="text" id="ubicacionDispositivo" placeholder="Localidad" maxlength="30">
                </div>
                
                <hr class="separador-config">
                
                <div class="form-group">
                    <label data-i18n="notificaciones_activar">Notificacions a enviar:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifInicio" checked>
                            <span data-i18n="notif_inicio">üîî Inici del sistema</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifMisa" checked>
                            <span data-i18n="notif_misa">‚õ™ Toc de Missa</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifDifuntos" checked>
                            <span data-i18n="notif_difuntos">üïäÔ∏è Toc de Difunts</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifFiesta" checked>
                            <span data-i18n="notif_fiesta">üéâ Toc de Festa</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifStop">
                            <span data-i18n="notif_stop">üõë Parada de seq√º√®ncies</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifCalefaccion" checked>
                            <span data-i18n="notif_calefaccion">üî• Calefacci√≥ activada</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifCalefaccionOff">
                            <span data-i18n="notif_calefaccion_off">‚ùÑÔ∏è Calefacci√≥ desactivada</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifAlarma" checked>
                            <span data-i18n="notif_alarma">‚è∞ Execuci√≥ d'alarmes</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifErrores">
                            <span data-i18n="notif_errores">‚ö†Ô∏è Errors cr√≠tics</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifInternet">
                            <span data-i18n="notif_internet">üåê Reconnexi√≥ a Internet</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifHora">
                            <span data-i18n="notif_hora">üïê Tocs d'hora</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifMediahora">
                            <span data-i18n="notif_mediahora">üïú Tocs de mitges hores</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifNtp">
                            <span data-i18n="notif_ntp">‚è±Ô∏è Sincronitzaci√≥ NTP</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifDns">
                            <span data-i18n="notif_dns">üåê Actualitzaci√≥ DNS</span>
                        </label>
                        
                        <label class="checkbox-item">
                            <input type="checkbox" id="notifAlarmaProgramada">
                            <span data-i18n="notif_alarma_programada">‚è∞ Alarma programada executada</span>
                        </label>
                    </div>
                </div>
                
                <div id="mensajeGuardado" class="mensaje-guardado" style="display: none;">
                    ‚úÖ <span data-i18n="configuracion_guardada">Configuraci√≥ guardada correctament</span>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-cancelar" onclick="cerrarModalConfigTelegram()" data-i18n="cancelar">Cancel¬∑lar</button>
                <button class="btn-aceptar" onclick="guardarConfigTelegram()" data-i18n="guardar">Guardar</button>
            </div>
        </div>
    </div>

    <!-- ‚úÖ MODAL DE ACTUALIZACI√ìN OTA -->
    <div id="modalOTA" class="modal">
        <div class="modal-content modal-ota">
            <div class="modal-header">
                <h2>üîÑ <span data-i18n="actualizacion">Actualitzaci√≥</span></h2>
                <span class="close" onclick="cerrarModalOTA()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="ota-info">
                    <div class="version-actual">
                        <strong data-i18n="version_actual">Versi√≥ actual:</strong>
                        <span id="versionActual">1.0.0</span>
                    </div>
                    
                    <div class="version-disponible" id="versionDisponibleContainer" style="display: none;">
                        <strong data-i18n="version_disponible">Versi√≥ disponible:</strong>
                        <span id="versionDisponible">-</span>
                    </div>
                </div>
                
                <div class="ota-estado" id="otaEstado">
                    <p data-i18n="ota_comprobar_desc">Comprova si hi ha actualitzacions disponibles</p>
                </div>
                
                <div class="ota-progreso" id="otaProgreso" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="otaProgressFill" style="width: 0%"></div>
                    </div>
                    <p id="otaMensaje">Comprovant...</p>
                </div>
                
                <div id="otaNotas" class="ota-notas" style="display: none;">
                    <h4 data-i18n="notas_version">Notes de la versi√≥:</h4>
                    <div id="otaNotasContenido"></div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-cancelar" id="btnCancelarOTA" onclick="cerrarModalOTA()" data-i18n="cerrar">Tancar</button>
                <button class="btn-secundario" id="btnComprobarOTA" onclick="comprobarActualizacion()" data-i18n="comprobar">Comprovar</button>
                <div id="botonesActualizacion" style="display: none; gap: 10px;">
                    <button class="btn-info" id="btnActualizarFirmware" onclick="iniciarActualizacion('firmware')" data-i18n="actualizar_firmware">Firmware</button>
                    <button class="btn-warning" id="btnActualizarSPIFFS" onclick="iniciarActualizacion('spiffs')" data-i18n="actualizar_spiffs">SPIFFS</button>
                    <button class="btn-aceptar" id="btnActualizarTodo" onclick="iniciarActualizacion('completo')" data-i18n="actualizar_completo">Completo</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ‚úÖ MODAL DE BACKUP -->
    <div id="modalBackup" class="modal">
        <div class="modal-content modal-backup">
            <div class="modal-header">
                <h2>üíæ <span data-i18n="backup">Backup</span></h2>
                <span class="close" onclick="cerrarModalBackup()">&times;</span>
            </div>
            
            <div class="modal-body">
                <p data-i18n="backup_descripcion">Descarrega c√≤pies de seguretat de les configuracions:</p>
                
                <div class="backup-opciones">
                    <div class="backup-item">
                        <div class="backup-info">
                            <strong>üìÖ alarmas_personalizadas.json</strong>
                            <small data-i18n="backup_alarmas_desc">Configuraci√≥ d'alarmes programades</small>
                        </div>
                        <div class="backup-acciones">
                            <button class="btn-info btn-small" onclick="descargarArchivo('alarmas_personalizadas.json')" data-i18n="descargar">Descarregar</button>
                            <button class="btn-warning btn-small" onclick="document.getElementById('uploadAlarmas').click()" data-i18n="restaurar">Restaurar</button>
                            <input type="file" id="uploadAlarmas" accept=".json" style="display: none;" onchange="subirArchivo(this, 'alarmas_personalizadas.json')">
                        </div>
                    </div>
                    
                    <div class="backup-item">
                        <div class="backup-info">
                            <strong>üì± telegram_config.json</strong>
                            <small data-i18n="backup_telegram_desc">Configuraci√≥ de Telegram</small>
                        </div>
                        <div class="backup-acciones">
                            <button class="btn-info btn-small" onclick="descargarArchivo('telegram_config.json')" data-i18n="descargar">Descarregar</button>
                            <button class="btn-warning btn-small" onclick="document.getElementById('uploadTelegram').click()" data-i18n="restaurar">Restaurar</button>
                            <input type="file" id="uploadTelegram" accept=".json" style="display: none;" onchange="subirArchivo(this, 'telegram_config.json')">
                        </div>
                    </div>
                    
                    <div class="backup-item">
                        <div class="backup-info">
                            <strong>‚öôÔ∏è config.json</strong>
                            <small data-i18n="backup_config_desc">Configuraci√≥ general del sistema</small>
                        </div>
                        <div class="backup-acciones">
                            <button class="btn-info btn-small" onclick="descargarArchivo('config.json')" data-i18n="descargar">Descarregar</button>
                            <button class="btn-warning btn-small" onclick="document.getElementById('uploadConfig').click()" data-i18n="restaurar">Restaurar</button>
                            <input type="file" id="uploadConfig" accept=".json" style="display: none;" onchange="subirArchivo(this, 'config.json')">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-cancelar" onclick="cerrarModalBackup()" data-i18n="cerrar">Tancar</button>
            </div>
        </div>
    </div>
    
</body>
</html>

